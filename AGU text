# Check if 'mail' command is installed and install 'mailutils' if needed
check_mail_dependency() {
    if ! command -v mail &> /dev/null; then
        echo "📦 'mail' command not found. Installing mailutils..." >&2
        log_info "'mail' not found, attempting to install mailutils"

        # Detect OS and install mailutils or equivalent
        if command -v apt &> /dev/null; then
            # Debian/Ubuntu
            sudo apt update && sudo apt install -y mailutils
        elif command -v yum &> /dev/null; then
            # CentOS/RHEL
            sudo yum install -y mailx
        elif command -v dnf &> /dev/null; then
            # Fedora
            sudo dnf install -y mailx
        elif command -v pacman &> /dev/null; then
            # Arch Linux
            sudo pacman -S --noconfirm mailutils
        elif command -v brew &> /dev/null; then
            # macOS
            brew install mailutils
        else
            echo "❌ Cannot automatically install mailutils. Please install it manually:" >&2
            echo "   Ubuntu/Debian: sudo apt install mailutils" >&2
            echo "   RHEL/CentOS:   sudo yum install mailx" >&2
            echo "   Fedora:        sudo dnf install mailx" >&2
            echo "   Arch:          sudo pacman -S mailutils" >&2
            log_error "Failed to auto-install mailutils - unsupported package manager"
            return 1
        fi

        # Verify installation
        if command -v mail &> /dev/null; then
            echo "✅ mailutils installed successfully" >&2
            log_info "mailutils installed successfully"
        else
            echo "❌ Failed to install mailutils" >&2
            log_error "Failed to install mailutils"
            return 1
        fi
    fi

    log_debug "Mail dependency check passed"
    return 0
}
